# Web Viewer Guide

Complete guide to using and customizing the Stack Visualization Web Viewer.

## Table of Contents

1. [Overview](#overview)
2. [Getting Started](#getting-started)
3. [User Interface](#user-interface)
4. [Features](#features)
5. [Log File Format](#log-file-format)
6. [Customization](#customization)
7. [Technical Details](#technical-details)

## Overview

The web viewer is a browser-based application that visualizes stack operations from log files generated by the Assembly stack simulator.

### Technology Stack

- **HTML5** - Structure
- **CSS3** - Styling with modern features (Grid, Flexbox, Gradients)
- **Vanilla JavaScript** - No frameworks, pure ES6+
- **SVG** - Icons for ESP and EBP pointers

### Browser Support

- Chrome/Edge 90+
- Firefox 88+
- Safari 14+
- Any modern browser with ES6 support

## Getting Started

### Opening the Viewer

1. **Local File:**
   ```
   Simply double-click index.html
   ```

2. **Local Web Server (Recommended):**
   ```bash
   # Python 3
   cd web-viewer
   python -m http.server 8000
   
   # Node.js
   npx http-server
   
   # PHP
   php -S localhost:8000
   ```
   Then navigate to: `http://localhost:8000`

### Loading a Log File

1. Click **"Choose File"** button
2. Select a `.txt` or `.log` file from `output/` directory
3. Click **"Load File"**
4. Wait for parsing (large files may take a moment)
5. Use playback controls to navigate

### Quick Start Example

1. Run a demo Assembly program:
   ```batch
   cd assembly
   Build.bat Programs\Fibonacci.asm
   Fibonacci.exe
   ```

2. Open web viewer in browser

3. Load `output/stacklog.txt`

4. Click **Play** to watch animation

## User Interface

### Layout

```
┌────────────────────────────────────────────────────┐
│              Header (Title)                        │
├──────────────┬─────────────────────────────────────┤
│   Controls   │   Stack Visualization               │
│   Panel      │                                     │
│              │   [Stack items displayed here]      │
│   - File     │                                     │
│   - Playback │                                     │
│   - Status   ├─────────────────────────────────────┤
│              │   Operation Log                     │
│              │   [List of all operations]          │
└──────────────┴─────────────────────────────────────┘
│              Footer                                │
└────────────────────────────────────────────────────┘
```

### Controls Panel

#### File Controls

**Choose File:**
- Standard file input
- Accepts `.txt`, `.log`, `.csv` files
- Shows selected filename

**Load File Button:**
- Enabled when file is selected
- Parses log file
- Shows operation count after load

#### Playback Controls

| Button | Function | Keyboard Shortcut |
|--------|----------|------------------|
| ⏮️ First | Go to first operation | Home |
| ⏪ Prev | Previous operation | ← |
| ▶️ Play | Auto-play forward | Space |
| ⏸️ Pause | Pause playback | Space |
| ⏩ Next | Next operation | → |
| ⏭️ Last | Go to last operation | End |

**Speed Slider:**
- Range: 100ms - 2000ms
- Default: 500ms
- Adjustable during playback
- Shows current speed value

#### Status Panel

**Operation:** Current operation type and value
```
PUSH 0x0000002A
```

**Step:** Current position / Total operations
```
15 / 42
```

**ESP:** Current stack pointer value
```
0x00100FFC
```

**EBP:** Current base pointer value
```
0x00101000
```

### Stack Visualization

**Display Features:**
- Shows top 32 stack entries
- Each entry displays:
  - Memory address
  - Value stored
  - Pointer indicators (ESP/EBP)

**Color Coding:**
- **Blue border** - ESP points here
- **Green border** - EBP points here
- **Orange border** - Both ESP and EBP
- **Hover effect** - Highlights on mouse over

**Pointer Indicators:**
- **← ESP** - Stack pointer location (cyan)
- **← EBP** - Base pointer location (green)
- **(return address)** - Marks return addresses from CALL

### Operation Log

**Features:**
- Scrollable list of all operations
- Click any entry to jump to that step
- Current operation highlighted in orange
- Auto-scrolls to keep current operation visible

**Color-Coded Borders:**
- **Blue** - PUSH operations
- **Red** - POP operations
- **Green** - CALL operations
- **Orange** - RET operations
- **Purple** - NEWFRAME/ENDFRAME operations

## Features

### Navigation

#### Step-by-Step

**Forward:**
```
Click "Next" or press →
```

**Backward:**
```
Click "Prev" or press ←
```

**Jump to Specific Step:**
```
Click on any entry in Operation Log
```

#### Auto-Play

**Start Playback:**
1. Click "Play" button
2. Operations advance automatically
3. Pauses at end

**Adjust Speed:**
- Move speed slider during playback
- Playback restarts with new speed
- Minimum: 100ms (fast)
- Maximum: 2000ms (slow)

**Pause:**
- Click "Pause" button
- Press Space bar
- Click any navigation button

### Visualization Features

#### Stack State Reconstruction

The viewer reconstructs stack state by simulating operations from the beginning:

```javascript
for each operation up to current:
    if PUSH: add to stack, decrement ESP
    if POP: remove from stack, increment ESP
    if CALL: add return address
    if RET: remove return address
```

This ensures accurate stack state at any point.

#### Highlighting

**ESP Highlighting:**
- Blue left border
- Light blue background
- "← ESP" indicator

**EBP Highlighting:**
- Green left border
- Light green background
- "← EBP" indicator

**Both Pointers:**
- Orange left border
- Orange background
- Shows both indicators

#### Return Address Marking

CALL operations create entries marked as "(return address)" to help identify function call boundaries.

### Interactive Features

#### Click to Navigate

**In Operation Log:**
- Click any operation
- Immediately jumps to that step
- Pauses playback if active
- Highlights in visualization

**Benefits:**
- Quick debugging
- Compare different states
- Find specific operations

#### Smooth Animations

**CSS Transitions:**
- Stack items fade in/out
- Smooth highlighting changes
- Pointer position updates
- Scroll animations

**Duration:** 300ms for most transitions

## Log File Format

### CSV Structure

Each line represents one operation:
```
OPERATION,VALUE,ESP=address,EBP=address
```

### Field Descriptions

**OPERATION:**
- `PUSH` - Push value onto stack
- `POP` - Pop value from stack
- `CALL` - Function call
- `RET` - Function return
- `NEWFRAME` - Create stack frame
- `ENDFRAME` - Destroy stack frame

**VALUE:**
- Hexadecimal value (with 0x prefix)
- For PUSH/POP: the data value
- For CALL/RET: return address
- For NEWFRAME/ENDFRAME: 0

**ESP=address:**
- Current stack pointer
- Hexadecimal format
- Example: `ESP=0x00100FFC`

**EBP=address:**
- Current base pointer
- Hexadecimal format
- Example: `EBP=0x00101000`

### Example Log File

```csv
PUSH,0x0000000A,ESP=0x00100FFC,EBP=0x00101000
PUSH,0x00000014,ESP=0x00100FF8,EBP=0x00101000
CALL,0x12345678,ESP=0x00100FF4,EBP=0x00101000
NEWFRAME,0,ESP=0x00100FF0,EBP=0x00100FF4
PUSH,0x00000005,ESP=0x00100FEC,EBP=0x00100FF4
POP,0x00000005,ESP=0x00100FF0,EBP=0x00100FF4
ENDFRAME,0,ESP=0x00100FF4,EBP=0x00101000
RET,0x12345678,ESP=0x00100FF8,EBP=0x00101000
POP,0x00000014,ESP=0x00100FFC,EBP=0x00101000
POP,0x0000000A,ESP=0x00101000,EBP=0x00101000
```

### Validation

The viewer performs basic validation:
- Minimum 4 fields per line
- ESP and EBP patterns must match
- Empty lines are skipped
- Invalid lines are ignored

## Customization

### Changing Colors

Edit `style.css` root variables:

```css
:root {
    --primary-color: #2563eb;     /* Main blue */
    --secondary-color: #7c3aed;   /* Purple */
    --success-color: #10b981;     /* Green */
    --danger-color: #ef4444;      /* Red */
    --warning-color: #f59e0b;     /* Orange */
    --esp-color: #3b82f6;         /* ESP blue */
    --ebp-color: #10b981;         /* EBP green */
}
```

### Adjusting Stack Display

**Change number of visible items:**

In `viewer.js`:
```javascript
const displayCount = Math.min(stackState.length, 32);
// Change 32 to your preferred number
```

**Modify item layout:**

In `style.css`:
```css
.stack-item {
    grid-template-columns: 120px 120px 1fr;
    /* Adjust column widths */
}
```

### Adding Custom Features

#### Example: Export to JSON

Add to `StackVisualizer` class:

```javascript
exportToJSON() {
    const data = {
        operations: this.operations,
        metadata: {
            totalSteps: this.operations.length,
            exported: new Date().toISOString()
        }
    };
    
    const blob = new Blob(
        [JSON.stringify(data, null, 2)], 
        {type: 'application/json'}
    );
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = 'stack-log.json';
    a.click();
}
```

Add button in HTML:
```html
<button id="exportBtn" onclick="visualizer.exportToJSON()">
    Export JSON
</button>
```

#### Example: Search Operations

```javascript
searchOperations(operationType) {
    return this.operations
        .map((op, index) => ({...op, index}))
        .filter(op => op.operation === operationType);
}
```

### Custom Themes

#### Dark Theme (Default)

Already implemented with dark background and vibrant colors.

#### Light Theme

Create alternative CSS:

```css
/* Light theme overrides */
.light-theme {
    --bg-color: #ffffff;
    --surface-color: #f8fafc;
    --card-color: #e2e8f0;
    --text-color: #1e293b;
    --text-secondary: #64748b;
    --border-color: #cbd5e1;
}
```

Toggle with JavaScript:
```javascript
document.body.classList.toggle('light-theme');
```

## Technical Details

### Architecture

#### Class-Based Design

```javascript
class StackVisualizer {
    constructor()           // Initialize
    loadFile()             // Parse log
    parseLogFile(text)     // Parse CSV
    goToStep(step)         // Navigate
    updateDisplay()        // Refresh UI
    renderStack(op)        // Draw stack
    buildStackState(step)  // Simulate stack
    play() / pause()       // Playback
}
```

#### Event-Driven

```javascript
// File events
fileInput.change → enable Load button
loadBtn.click → loadFile()

// Playback events
playBtn.click → play()
pauseBtn.click → pause()

// Speed events
speedSlider.input → update speed

// Log events
logEntry.click → goToStep()
```

### Performance Considerations

#### Efficient Rendering

**Virtual Scrolling:**
Only show top 32 items to limit DOM nodes.

**Batch Updates:**
Update all display elements at once to minimize reflows.

**CSS Transitions:**
Use GPU-accelerated properties (transform, opacity).

#### Memory Management

**Large Files:**
- Parse incrementally if needed
- Consider pagination for 10,000+ operations
- Use WeakMap for caching if implementing

**Current Limits:**
- Tested with up to 5,000 operations
- Memory usage: ~10MB for typical logs
- Load time: <500ms for 1,000 operations

### Browser Compatibility

#### Required Features

- ES6 Classes
- Arrow Functions
- Template Literals
- Promises
- FileReader API
- CSS Grid
- CSS Custom Properties

#### Polyfills

Not included by default. For older browsers:

```html
<script src="https://polyfill.io/v3/polyfill.min.js"></script>
```

### Accessibility

#### Keyboard Navigation

- Tab through controls
- Space for play/pause
- Arrow keys for step navigation
- Enter to activate buttons

#### Screen Readers

Add ARIA labels:
```html
<button aria-label="Play visualization">▶️ Play</button>
```

#### High Contrast

CSS supports prefers-contrast:
```css
@media (prefers-contrast: high) {
    :root {
        --border-color: #000000;
    }
}
```

## Troubleshooting

### File Won't Load

**Check:**
1. File is valid CSV format
2. File has correct extension (.txt, .log, .csv)
3. Browser console for errors (F12)
4. File size (<10MB recommended)

**Solutions:**
- Validate CSV format
- Check for special characters
- Try smaller file first

### Incorrect Visualization

**Possible Causes:**
1. Malformed log entries
2. Missing ESP/EBP values
3. Operations out of order

**Debug Steps:**
1. Open browser console (F12)
2. Check parsed operations array
3. Verify stack simulation logic
4. Compare with Assembly output

### Slow Performance

**For Large Files:**
1. Reduce displayCount in code
2. Disable smooth scrolling
3. Use pagination
4. Pre-filter operations

**Optimization:**
```javascript
// Disable transitions for large files
if (this.operations.length > 1000) {
    document.body.classList.add('no-transitions');
}
```

### Visual Glitches

**Browser-Specific:**
- Clear cache and reload
- Try different browser
- Update to latest version
- Check CSS compatibility

## Best Practices

### For Users

1. **Start Small:** Test with simple programs first
2. **Use Speed Control:** Adjust to comfortable pace
3. **Pause Often:** Examine state at key points
4. **Click to Navigate:** Jump to interesting operations
5. **Compare States:** Use stack display to understand changes

### For Developers

1. **Validate Input:** Check log format before parsing
2. **Handle Errors:** Graceful degradation for bad data
3. **Optimize Rendering:** Limit DOM manipulations
4. **Comment Code:** Explain complex algorithms
5. **Test Browsers:** Verify cross-browser compatibility

## Advanced Usage

### Batch Processing

Process multiple log files:

```javascript
async function loadMultipleLogs(files) {
    const results = [];
    for (const file of files) {
        const text = await file.text();
        const ops = parseLogFile(text);
        results.push({filename: file.name, operations: ops});
    }
    return results;
}
```

### Comparison Mode

Compare two log files side-by-side:

1. Create two StackVisualizer instances
2. Synchronize currentStep
3. Display in split view
4. Highlight differences

### Recording Animation

Use browser tools:
1. Chrome DevTools → Performance → Record
2. Use screen recording software
3. Export as video or GIF

## Resources

- [MDN Web Docs](https://developer.mozilla.org/en-US/)
- [CSS Grid Guide](https://css-tricks.com/snippets/css/complete-guide-grid/)
- [JavaScript Classes](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes)
- [SVG Tutorial](https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial)

---

**Next Steps:**
- Try the examples in [EXAMPLES.md](EXAMPLES.md)
- Customize the viewer for your needs
- Create your own demo programs
